{"version":3,"sources":["webpack://@flarum/tags/webpack/bootstrap","webpack://@flarum/tags/external \"flarum.core.compat['Model']\"","webpack://@flarum/tags/external \"flarum.core.compat['extend']\"","webpack://@flarum/tags/./src/common/utils/sortTags.js","webpack://@flarum/tags/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flarum/tags/./src/common/helpers/tagIcon.js","webpack://@flarum/tags/./src/common/helpers/tagLabel.js","webpack://@flarum/tags/external \"flarum.core.compat['components/IndexPage']\"","webpack://@flarum/tags/./src/common/helpers/tagsLabel.js","webpack://@flarum/tags/external \"flarum.core.compat['components/Button']\"","webpack://@flarum/tags/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@flarum/tags/./src/common/models/Tag.js","webpack://@flarum/tags/external \"flarum.core.compat['utils/extract']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/classList']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/mixin']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/computed']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Page']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Modal']\"","webpack://@flarum/tags/./src/common/compat.js","webpack://@flarum/tags/external \"flarum.core\"","webpack://@flarum/tags/external \"flarum.core.compat['components/LinkButton']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@flarum/tags/external \"flarum.core.compat['models/Discussion']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@flarum/tags/./src/forum/components/TagsPage.js","webpack://@flarum/tags/./src/forum/components/DiscussionTaggedPost.js","webpack://@flarum/tags/./src/forum/components/TagLinkButton.js","webpack://@flarum/tags/./src/forum/addTagList.js","webpack://@flarum/tags/./src/forum/components/TagHero.js","webpack://@flarum/tags/./src/forum/addTagFilter.js","webpack://@flarum/tags/./src/forum/addTagLabels.js","webpack://@flarum/tags/./src/forum/components/TagDiscussionModal.js","webpack://@flarum/tags/./src/forum/addTagControl.js","webpack://@flarum/tags/./src/forum/addTagComposer.js","webpack://@flarum/tags/./src/forum/compat.js","webpack://@flarum/tags/./src/forum/index.js","webpack://@flarum/tags/external \"flarum.core.compat['helpers/listItems']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/humanTime']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/EventPost']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/Separator']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionList']\"","webpack://@flarum/tags/external \"flarum.core.compat['Component']\"","webpack://@flarum/tags/external \"flarum.core.compat['components/DiscussionListItem']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@flarum/tags/external \"flarum.core.compat['helpers/highlight']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/extractText']\"","webpack://@flarum/tags/external \"flarum.core.compat['utils/KeyboardNavigatable']\"","webpack://@flarum/tags/./forum.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","sortTags","tags","slice","sort","a","b","aPos","position","bPos","discussionCount","aParent","parent","bParent","_inheritsLoose","subClass","superClass","constructor","__proto__","tagIcon","tag","attrs","settings","hasIcon","icon","useColor","className","classList","style","color","backgroundColor","tagLabel","link","extract","tagText","app","translator","trans","imagePath","title","description","href","route","slug","config","src","height","tagsLabel","children","forEach","length","showInTagLabels","push","_extends","assign","target","arguments","source","apply","this","Tag","mixin","Model","attribute","backgroundUrl","backgroundMode","hasOne","defaultSort","isChild","isHidden","lastPostedAt","transformDate","lastPostedDiscussion","isRestricted","canStartDiscussion","canAddToDiscussion","displayOrder","showonHomePage","bannerImagePath","isPrimary","computed","TagsPage","init","store","all","filter","history","view","pinned","cloud","IndexPage","hero","affixSidebar","listItems","sidebarItems","toArray","map","child","element","isInitialized","$","on","e","stopPropagation","discussion","lastPostNumber","humanTime","args","setTitle","setTitleCount","Page","DiscussionTaggedPost","initProps","props","oldTags","post","content","newTags","diffTags","tags1","tags2","indexOf","id","getById","tagsAdded","tagsRemoved","descriptionKey","descriptionData","data","transChoice","count","EventPost","TagLinkButton","active","isActive","params","LinkButton","extend","items","add","component","current","Separator","stickyParams","currentTag","addTag","more","splice","TagHero","Component","getBy","override","original","vdom","param","DiscussionList","include","q","DiscussionListItem","DiscussionPage","DiscussionHero","TagDiscussionModal","selected","prop","index","focused","selectedTags","minPrimary","forum","maxPrimary","minSecondary","maxSecondary","navigator","KeyboardNavigatable","onUp","setIndex","getCurrentNumericIndex","onDown","onSelect","select","onRemove","primaryCount","secondaryCount","removeTag","getInstruction","remaining","toLowerCase","substr","onclick","onready","placeholder","extractText","oninput","withAttr","onkeydown","navigate","onfocus","onblur","Button","type","disabled","data-index","colored","onmouseover","toggleTag","highlight","metaKey","ctrlKey","submit","getItem","dispatchEvent","Event","selectableItems","scrollToItem","$items","$dropdown","$item","eq","attr","redraw","scrollTop","dropdownScroll","dropdownTop","offset","top","dropdownBottom","outerHeight","itemTop","itemBottom","parseInt","css","stop","animate","onsubmit","preventDefault","save","relationships","then","stream","update","modal","close","strategy","Modal","DiscussionControls","canTag","show","promise","DiscussionComposer","chooseTags","focus","chosenTags","chosenPrimaryTags","chosenSecondaryTags","addTagFilter","addTagControl","addTagList","addTagLabels","addTagComposer","initializers","routes","path","postComponents","discussionTagged","models","Discussion","hasMany","tagsCompat"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 48);\n","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['extend'];","export default function sortTags(tags) {\r\n  return tags.slice(0).sort((a, b) => {\r\n    const aPos = a.position();\r\n    const bPos = b.position();\r\n\r\n    // If they're both secondary tags, sort them by their discussions count,\r\n    // descending.\r\n    if (aPos === null && bPos === null)\r\n      return b.discussionCount() - a.discussionCount();\r\n\r\n    // If just one is a secondary tag, then the primary tag should\r\n    // come first.\r\n    if (bPos === null) return -1;\r\n    if (aPos === null) return 1;\r\n\r\n    // If we've made it this far, we know they're both primary tags. So we'll\r\n    // need to see if they have parents.\r\n    const aParent = a.parent();\r\n    const bParent = b.parent();\r\n\r\n    // If they both have the same parent, then their positions are local,\r\n    // so we can compare them directly.\r\n    if (aParent === bParent) return aPos - bPos;\r\n\r\n    // If they are both child tags, then we will compare the positions of their\r\n    // parents.\r\n    else if (aParent && bParent)\r\n      return aParent.position() - bParent.position();\r\n\r\n    // If we are comparing a child tag with its parent, then we let the parent\r\n    // come first. If we are comparing an unrelated parent/child, then we\r\n    // compare both of the parents.\r\n    else if (aParent)\r\n      return aParent === b ? 1 : aParent.position() - bPos;\r\n\r\n    else if (bParent)\r\n      return bParent === a ? -1 : aPos - bParent.position();\r\n\r\n    return 0;\r\n  });\r\n}\r\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import classList from 'flarum/utils/classList';\r\n\r\nexport default function tagIcon(tag, attrs = {}, settings = {}) {\r\n  const hasIcon = tag && tag.icon();\r\n  const { useColor = true } = settings;\r\n\r\n  attrs.className = classList([\r\n    attrs.className,\r\n    'icon',\r\n    hasIcon ? tag.icon() : 'TagIcon'\r\n  ]);\r\n\r\n  if (tag) {\r\n    attrs.style = attrs.style || {};\r\n\r\n    if (hasIcon) {\r\n      attrs.style.color = useColor ? tag.color() : '';\r\n    } else {\r\n      attrs.style.backgroundColor = tag.color();\r\n    }\r\n\r\n  } else {\r\n    attrs.className += ' untagged';\r\n  }\r\n\r\n  return hasIcon ? <i {...attrs}/> : <span {...attrs}/>;\r\n}\r\n","import extract from \"flarum/utils/extract\";\r\nimport tagIcon from \"./tagIcon\";\r\n\r\nexport default function tagLabel(tag, attrs = {}) {\r\n  attrs.style = attrs.style || {};\r\n  attrs.className = \"TagLabel \" + (attrs.className || \"\");\r\n\r\n  const link = extract(attrs, \"link\");\r\n  const tagText = tag\r\n    ? tag.name()\r\n    : app.translator.trans(\"flarum-tags.lib.deleted_tag_text\");\r\n  const imagePath = tag.imagePath();\r\n\r\n  if (tag) {\r\n    const color = tag.color();\r\n    if (color) {\r\n      attrs.style.backgroundColor = attrs.style.color = color;\r\n      attrs.className += \" colored\";\r\n    }\r\n\r\n    if (link) {\r\n      attrs.title = tag.description() || \"\";\r\n      attrs.href = app.route(\"tag\", { tags: tag.slug() });\r\n      attrs.config = m.route;\r\n    }\r\n    if (imagePath != \"\") {\r\n      attrs.className = \"\";\r\n    }\r\n  } else {\r\n    attrs.className += \" untagged\";\r\n  }\r\n\r\n  return m(\r\n    link ? \"a\" : \"span\",\r\n    attrs,\r\n    <span className=\"TagLabel-text\">\r\n      {tag\r\n        ? imagePath != \"\"\r\n          ? m(\"img\", { src: imagePath, height: \"16.5em\" })\r\n          : tagText\r\n        : tag.icon() && tagIcon(tag, {}, { useColor: false })}{\" \"}\r\n    </span>\r\n  );\r\n}\r\n","module.exports = flarum.core.compat['components/IndexPage'];","import extract from 'flarum/utils/extract';\r\nimport tagLabel from './tagLabel';\r\nimport sortTags from '../utils/sortTags';\r\n\r\nexport default function tagsLabel(tags, attrs = {}) {\r\n  const children = [];\r\n  const link = extract(attrs, 'link');\r\n\r\n  attrs.className = 'TagsLabel ' + (attrs.className || '');\r\n\r\n  if (tags) {\r\n    sortTags(tags).forEach(tag => {\r\n      if (tag || tags.length === 1) {\r\n        if(tag.showInTagLabels())\r\n        children.push(tagLabel(tag, {link}));\r\n      }\r\n    });\r\n  } else {\r\n    children.push(tagLabel());\r\n  }\r\n\r\n  return <span {...attrs}>{children}</span>;\r\n}\r\n","module.exports = flarum.core.compat['components/Button'];","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import Model from \"flarum/Model\";\r\nimport mixin from \"flarum/utils/mixin\";\r\nimport computed from \"flarum/utils/computed\";\r\n\r\nexport default class Tag extends mixin(Model, {\r\n  name: Model.attribute(\"name\"),\r\n  slug: Model.attribute(\"slug\"),\r\n  description: Model.attribute(\"description\"),\r\n\r\n  color: Model.attribute(\"color\"),\r\n  backgroundUrl: Model.attribute(\"backgroundUrl\"),\r\n  backgroundMode: Model.attribute(\"backgroundMode\"),\r\n  icon: Model.attribute(\"icon\"),\r\n\r\n  position: Model.attribute(\"position\"),\r\n  parent: Model.hasOne(\"parent\"),\r\n  defaultSort: Model.attribute(\"defaultSort\"),\r\n  isChild: Model.attribute(\"isChild\"),\r\n  isHidden: Model.attribute(\"isHidden\"),\r\n\r\n  discussionCount: Model.attribute(\"discussionCount\"),\r\n  lastPostedAt: Model.attribute(\"lastPostedAt\", Model.transformDate),\r\n  lastPostedDiscussion: Model.hasOne(\"lastPostedDiscussion\"),\r\n\r\n  isRestricted: Model.attribute(\"isRestricted\"),\r\n  canStartDiscussion: Model.attribute(\"canStartDiscussion\"),\r\n  canAddToDiscussion: Model.attribute(\"canAddToDiscussion\"),\r\n  imagePath: Model.attribute(\"imagePath\"),\r\n  showInTagLabels: Model.attribute(\"showInTagLabels\"),\r\n  displayOrder: Model.attribute(\"displayOrder\"),\r\n  showonHomePage: Model.attribute(\"showonHomePage\"),\r\n  bannerImagePath: Model.attribute(\"bannerImagePath\"),\r\n  isPrimary: computed(\r\n    \"position\",\r\n    \"parent\",\r\n    (position, parent) => position !== null && parent === false\r\n  ),\r\n}) {}\r\n","module.exports = flarum.core.compat['utils/extract'];","module.exports = flarum.core.compat['utils/classList'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['utils/mixin'];","module.exports = flarum.core.compat['utils/computed'];","module.exports = flarum.core.compat['components/Page'];","module.exports = flarum.core.compat['components/Modal'];","import sortTags from './utils/sortTags';\r\nimport Tag from './models/Tag';\r\nimport tagsLabel from './helpers/tagsLabel';\r\nimport tagIcon from './helpers/tagIcon';\r\nimport tagLabel from './helpers/tagLabel';\r\n\r\nexport default {\r\n  'tags/utils/sortTags': sortTags,\r\n  'tags/models/Tag': Tag,\r\n  'tags/helpers/tagsLabel': tagsLabel,\r\n  'tags/helpers/tagIcon': tagIcon,\r\n  'tags/helpers/tagLabel': tagLabel\r\n};\r\n","module.exports = flarum.core;","module.exports = flarum.core.compat['components/LinkButton'];","module.exports = flarum.core.compat['components/DiscussionPage'];","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['components/DiscussionHero'];","import Page from 'flarum/components/Page';\r\nimport IndexPage from 'flarum/components/IndexPage';\r\nimport listItems from 'flarum/helpers/listItems';\r\nimport humanTime from 'flarum/helpers/humanTime';\r\n\r\nimport tagLabel from '../../common/helpers/tagLabel';\r\nimport sortTags from '../../common/utils/sortTags';\r\n\r\nexport default class TagsPage extends Page {\r\n  init() {\r\n    super.init();\r\n\r\n    this.tags = sortTags(app.store.all('tags').filter(tag => !tag.parent()));\r\n\r\n    app.history.push('tags', app.translator.trans('flarum-tags.forum.header.back_to_tags_tooltip'));\r\n  }\r\n\r\n  view() {\r\n    const pinned = this.tags.filter(tag => tag.position() !== null);\r\n    const cloud = this.tags.filter(tag => tag.position() === null);\r\n\r\n    return (\r\n      <div className=\"TagsPage\">\r\n        {IndexPage.prototype.hero()}\r\n        <div className=\"container\">\r\n          <nav className=\"TagsPage-nav IndexPage-nav sideNav\" config={IndexPage.prototype.affixSidebar}>\r\n            <ul>{listItems(IndexPage.prototype.sidebarItems().toArray())}</ul>\r\n          </nav>\r\n\r\n          <div className=\"TagsPage-content sideNavOffset\">\r\n            <ul className=\"TagTiles\">\r\n              {pinned.map(tag => {\r\n                const lastPostedDiscussion = tag.lastPostedDiscussion();\r\n                const children = sortTags(app.store.all('tags').filter(child => child.parent() === tag));\r\n\r\n                return (\r\n                  <li className={'TagTile ' + (tag.color() ? 'colored' : '')}\r\n                    style={{backgroundColor: tag.color()}}>\r\n                    <a className=\"TagTile-info\" href={app.route.tag(tag)} config={m.route}>\r\n                      <h3 className=\"TagTile-name\">{tag.name()}</h3>\r\n                      <p className=\"TagTile-description\">{tag.description()}</p>\r\n                      {children\r\n                        ? (\r\n                          <div className=\"TagTile-children\">\r\n                            {children.map(child => [\r\n                              <a href={app.route.tag(child)} config={function(element, isInitialized) {\r\n                                if (isInitialized) return;\r\n                                $(element).on('click', e => e.stopPropagation());\r\n                                m.route.apply(this, arguments);\r\n                              }}>\r\n                                {child.name()}\r\n                              </a>,\r\n                              ' '\r\n                            ])}\r\n                          </div>\r\n                        ) : ''}\r\n                    </a>\r\n                    {lastPostedDiscussion\r\n                      ? (\r\n                        <a className=\"TagTile-lastPostedDiscussion\"\r\n                          href={app.route.discussion(lastPostedDiscussion, lastPostedDiscussion.lastPostNumber())}\r\n                          config={m.route}>\r\n                          <span className=\"TagTile-lastPostedDiscussion-title\">{lastPostedDiscussion.title()}</span>\r\n                          {humanTime(lastPostedDiscussion.lastPostedAt())}\r\n                        </a>\r\n                      ) : (\r\n                        <span className=\"TagTile-lastPostedDiscussion\"/>\r\n                      )}\r\n                  </li>\r\n                );\r\n              })}\r\n            </ul>\r\n\r\n            {cloud.length ? (\r\n              <div className=\"TagCloud\">\r\n                {cloud.map(tag => [\r\n                  tagLabel(tag, {link: true}),\r\n                  ' ',\r\n                ])}\r\n              </div>\r\n            ) : ''}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  config(...args) {\r\n    super.config(...args);\r\n\r\n    app.setTitle(app.translator.trans('flarum-tags.forum.all_tags.meta_title_text'));\r\n    app.setTitleCount(0);\r\n  }\r\n}\r\n","import EventPost from 'flarum/components/EventPost';\r\nimport tagsLabel from '../../common/helpers/tagsLabel';\r\n\r\nexport default class DiscussionTaggedPost extends EventPost {\r\n  static initProps(props) {\r\n    super.initProps(props);\r\n\r\n    const oldTags = props.post.content()[0];\r\n    const newTags = props.post.content()[1];\r\n\r\n    function diffTags(tags1, tags2) {\r\n      return tags1\r\n        .filter(tag => tags2.indexOf(tag) === -1)\r\n        .map(id => app.store.getById('tags', id));\r\n    }\r\n\r\n    props.tagsAdded = diffTags(newTags, oldTags);\r\n    props.tagsRemoved = diffTags(oldTags, newTags);\r\n  }\r\n\r\n  icon() {\r\n    return 'fas fa-tag';\r\n  }\r\n\r\n  descriptionKey() {\r\n    if (this.props.tagsAdded.length) {\r\n      if (this.props.tagsRemoved.length) {\r\n        return 'flarum-tags.forum.post_stream.added_and_removed_tags_text';\r\n      }\r\n\r\n      return 'flarum-tags.forum.post_stream.added_tags_text';\r\n    }\r\n\r\n    return 'flarum-tags.forum.post_stream.removed_tags_text';\r\n  }\r\n\r\n  descriptionData() {\r\n    const data = {};\r\n\r\n    if (this.props.tagsAdded.length) {\r\n      data.tagsAdded = app.translator.transChoice('flarum-tags.forum.post_stream.tags_text', this.props.tagsAdded.length, {\r\n        tags: tagsLabel(this.props.tagsAdded, {link: true}),\r\n        count: this.props.tagsAdded.length\r\n      });\r\n    }\r\n\r\n    if (this.props.tagsRemoved.length) {\r\n      data.tagsRemoved = app.translator.transChoice('flarum-tags.forum.post_stream.tags_text', this.props.tagsRemoved.length, {\r\n        tags: tagsLabel(this.props.tagsRemoved, {link: true}),\r\n        count: this.props.tagsRemoved.length\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n}\r\n","import LinkButton from 'flarum/components/LinkButton';\r\nimport tagIcon from '../../common/helpers/tagIcon';\r\n\r\nexport default class TagLinkButton extends LinkButton {\r\n  view() {\r\n    const tag = this.props.tag;\r\n    const active = this.constructor.isActive(this.props);\r\n    const description = tag && tag.description();\r\n\r\n    return (\r\n      <a className={'TagLinkButton hasIcon ' + (tag.isChild() ? 'child' : '')} href={this.props.href} config={m.route}\r\n        style={active && tag ? {color: tag.color()} : ''}\r\n        title={description || ''}>\r\n        {tagIcon(tag, {className: 'Button-icon'})}\r\n        {this.props.children}\r\n      </a>\r\n    );\r\n  }\r\n\r\n  static initProps(props) {\r\n    const tag = props.tag;\r\n\r\n    props.params.tags = tag ? tag.slug() : 'untagged';\r\n    props.href = app.route('tag', props.params);\r\n    props.children = tag ? tag.name() : app.translator.trans('flarum-tags.forum.index.untagged_link');\r\n  }\r\n}\r\n","import { extend } from 'flarum/extend';\r\nimport IndexPage from 'flarum/components/IndexPage';\r\nimport Separator from 'flarum/components/Separator';\r\nimport LinkButton from 'flarum/components/LinkButton';\r\n\r\nimport TagLinkButton from './components/TagLinkButton';\r\nimport TagsPage from './components/TagsPage';\r\nimport sortTags from '../common/utils/sortTags';\r\n\r\nexport default function() {\r\n  // Add a link to the tags page, as well as a list of all the tags,\r\n  // to the index page's sidebar.\r\n  extend(IndexPage.prototype, 'navItems', function(items) {\r\n    items.add('tags', LinkButton.component({\r\n      icon: 'fas fa-th-large',\r\n      children: app.translator.trans('flarum-tags.forum.index.tags_link'),\r\n      href: app.route('tags')\r\n    }), -10);\r\n\r\n    if (app.current instanceof TagsPage) return;\r\n\r\n    items.add('separator', Separator.component(), -12);\r\n\r\n    const params = this.stickyParams();\r\n    const tags = app.store.all('tags');\r\n    const currentTag = this.currentTag();\r\n\r\n    const addTag = tag => {\r\n      let active = currentTag === tag;\r\n\r\n      if (!active && currentTag) {\r\n        active = currentTag.parent() === tag;\r\n      }\r\n\r\n      items.add('tag' + tag.id(), TagLinkButton.component({tag, params, active}), -14);\r\n    };\r\n\r\n    sortTags(tags)\r\n      .filter(tag => tag.position() !== null && (!tag.isChild() || (currentTag && (tag.parent() === currentTag || tag.parent() === currentTag.parent()))))\r\n      .forEach(addTag);\r\n\r\n    const more = tags\r\n      .filter(tag => tag.position() === null)\r\n      .sort((a, b) => b.discussionCount() - a.discussionCount());\r\n\r\n    more.splice(0, 3).forEach(addTag);\r\n\r\n    if (more.length) {\r\n      items.add('moreTags', LinkButton.component({\r\n        children: app.translator.trans('flarum-tags.forum.index.more_link'),\r\n        href: app.route('tags')\r\n      }), -16);\r\n    }\r\n  });\r\n}\r\n","import Component from 'flarum/Component';\r\nimport tagIcon from '../../common/helpers/tagIcon';\r\n\r\nexport default class TagHero extends Component {\r\n  view() {\r\n    const tag = this.props.tag;\r\n    const color = tag.color();\r\n\r\n    return (\r\n      <header className={'Hero TagHero' + (color ? ' TagHero--colored' : '')}\r\n        style={color ? {color: '#fff', backgroundColor: color} : ''}>\r\n        <div className=\"container\">\r\n          <div className=\"containerNarrow\">\r\n            <h2 className=\"Hero-title\">{tag.icon() && tagIcon(tag, {}, { useColor: false })} {tag.name()}</h2>\r\n            <div className=\"Hero-subtitle\">{tag.description()}</div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n    );\r\n  }\r\n}\r\n","import { extend, override } from 'flarum/extend';\r\nimport IndexPage from 'flarum/components/IndexPage';\r\nimport DiscussionList from 'flarum/components/DiscussionList';\r\n\r\nimport TagHero from './components/TagHero';\r\n\r\nexport default function() {\r\n  IndexPage.prototype.currentTag = function() {\r\n    const slug = this.params().tags;\r\n\r\n    if (slug) return app.store.getBy('tags', 'slug', slug);\r\n  };\r\n\r\n  // If currently viewing a tag, insert a tag hero at the top of the view.\r\n  override(IndexPage.prototype, 'hero', function(original) {\r\n    const tag = this.currentTag();\r\n\r\n    if (tag) return TagHero.component({tag});\r\n\r\n    return original();\r\n  });\r\n\r\n  extend(IndexPage.prototype, 'view', function(vdom) {\r\n    const tag = this.currentTag();\r\n\r\n    if (tag) vdom.attrs.className += ' IndexPage--tag'+tag.id();\r\n  });\r\n\r\n  extend(IndexPage.prototype, 'config', function() {\r\n    const tag = this.currentTag();\r\n\r\n    if (tag) {\r\n      app.setTitle(tag.name());\r\n    }\r\n  });\r\n\r\n  // If currently viewing a tag, restyle the 'new discussion' button to use\r\n  // the tag's color.\r\n  extend(IndexPage.prototype, 'sidebarItems', function(items) {\r\n    const tag = this.currentTag();\r\n\r\n    if (tag) {\r\n      const color = tag.color();\r\n\r\n      if (color) {\r\n        items.get('newDiscussion').props.style = {backgroundColor: color};\r\n      }\r\n    }\r\n  });\r\n\r\n  // Add a parameter for the IndexPage to pass on to the DiscussionList that\r\n  // will let us filter discussions by tag.\r\n  extend(IndexPage.prototype, 'params', function(params) {\r\n    params.tags = m.route.param('tags');\r\n  });\r\n\r\n  // Translate that parameter into a gambit appended to the search query.\r\n  extend(DiscussionList.prototype, 'requestParams', function(params) {\r\n    params.include.push('tags');\r\n\r\n    if (this.props.params.tags) {\r\n      params.filter.q = (params.filter.q || '') + ' tag:' + this.props.params.tags;\r\n    }\r\n  });\r\n}\r\n","import { extend } from 'flarum/extend';\r\nimport DiscussionListItem from 'flarum/components/DiscussionListItem';\r\nimport DiscussionPage from 'flarum/components/DiscussionPage';\r\nimport DiscussionHero from 'flarum/components/DiscussionHero';\r\n\r\nimport tagsLabel from '../common/helpers/tagsLabel';\r\nimport sortTags from '../common/utils/sortTags';\r\n\r\nexport default function() {\r\n  // Add tag labels to each discussion in the discussion list.\r\n  extend(DiscussionListItem.prototype, 'infoItems', function(items) {\r\n    const tags = this.props.discussion.tags();\r\n\r\n    if (tags && tags.length) {\r\n      items.add('tags', tagsLabel(tags), 10);\r\n    }\r\n  });\r\n\r\n  // Include a discussion's tags when fetching it.\r\n  extend(DiscussionPage.prototype, 'params', function(params) {\r\n    params.include.push('tags');\r\n  });\r\n\r\n  // Restyle a discussion's hero to use its first tag's color.\r\n  extend(DiscussionHero.prototype, 'view', function(view) {\r\n    const tags = sortTags(this.props.discussion.tags());\r\n\r\n    if (tags && tags.length) {\r\n      const color = tags[0].color();\r\n      if (color) {\r\n        view.attrs.style = {backgroundColor: color};\r\n        view.attrs.className += ' DiscussionHero--colored';\r\n      }\r\n    }\r\n  });\r\n\r\n  // Add a list of a discussion's tags to the discussion hero, displayed\r\n  // before the title. Put the title on its own line.\r\n  extend(DiscussionHero.prototype, 'items', function(items) {\r\n    const tags = this.props.discussion.tags();\r\n\r\n    if (tags && tags.length) {\r\n      items.add('tags', tagsLabel(tags, {link: true}), 5);\r\n    }\r\n  });\r\n}\r\n","import Modal from 'flarum/components/Modal';\r\nimport DiscussionPage from 'flarum/components/DiscussionPage';\r\nimport Button from 'flarum/components/Button';\r\nimport highlight from 'flarum/helpers/highlight';\r\nimport classList from 'flarum/utils/classList';\r\nimport extractText from 'flarum/utils/extractText';\r\nimport KeyboardNavigatable from 'flarum/utils/KeyboardNavigatable';\r\n\r\nimport tagLabel from '../../common/helpers/tagLabel';\r\nimport tagIcon from '../../common/helpers/tagIcon';\r\nimport sortTags from '../../common/utils/sortTags';\r\n\r\nexport default class TagDiscussionModal extends Modal {\r\n  init() {\r\n    super.init();\r\n\r\n    this.tags = app.store.all('tags');\r\n\r\n    if (this.props.discussion) {\r\n      this.tags = this.tags.filter(tag => tag.canAddToDiscussion() || this.props.discussion.tags().indexOf(tag) !== -1);\r\n    } else {\r\n      this.tags = this.tags.filter(tag => tag.canStartDiscussion());\r\n    }\r\n\r\n    this.tags = sortTags(this.tags);\r\n\r\n    this.selected = [];\r\n    this.filter = m.prop('');\r\n    this.index = this.tags[0].id();\r\n    this.focused = false;\r\n\r\n    if (this.props.selectedTags) {\r\n      this.props.selectedTags.map(this.addTag.bind(this));\r\n    } else if (this.props.discussion) {\r\n      this.props.discussion.tags().map(this.addTag.bind(this));\r\n    }\r\n\r\n    this.minPrimary = app.forum.attribute('minPrimaryTags');\r\n    this.maxPrimary = app.forum.attribute('maxPrimaryTags');\r\n    this.minSecondary = app.forum.attribute('minSecondaryTags');\r\n    this.maxSecondary = app.forum.attribute('maxSecondaryTags');\r\n\r\n    this.navigator = new KeyboardNavigatable();\r\n    this.navigator\r\n      .onUp(() => this.setIndex(this.getCurrentNumericIndex() - 1, true))\r\n      .onDown(() => this.setIndex(this.getCurrentNumericIndex() + 1, true))\r\n      .onSelect(this.select.bind(this))\r\n      .onRemove(() => this.selected.splice(this.selected.length - 1, 1));\r\n  }\r\n\r\n  primaryCount() {\r\n    return this.selected.filter(tag => tag.isPrimary()).length;\r\n  }\r\n\r\n  secondaryCount() {\r\n    return this.selected.filter(tag => !tag.isPrimary()).length;\r\n  }\r\n\r\n  /**\r\n   * Add the given tag to the list of selected tags.\r\n   *\r\n   * @param {Tag} tag\r\n   */\r\n  addTag(tag) {\r\n    if (!tag.canStartDiscussion()) return;\r\n\r\n    // If this tag has a parent, we'll also need to add the parent tag to the\r\n    // selected list if it's not already in there.\r\n    const parent = tag.parent();\r\n    if (parent) {\r\n      const index = this.selected.indexOf(parent);\r\n      if (index === -1) {\r\n        this.selected.push(parent);\r\n      }\r\n    }\r\n\r\n    this.selected.push(tag);\r\n  }\r\n\r\n  /**\r\n   * Remove the given tag from the list of selected tags.\r\n   *\r\n   * @param {Tag} tag\r\n   */\r\n  removeTag(tag) {\r\n    const index = this.selected.indexOf(tag);\r\n    if (index !== -1) {\r\n      this.selected.splice(index, 1);\r\n\r\n      // Look through the list of selected tags for any tags which have the tag\r\n      // we just removed as their parent. We'll need to remove them too.\r\n      this.selected\r\n        .filter(selected => selected.parent() === tag)\r\n        .forEach(this.removeTag.bind(this));\r\n    }\r\n  }\r\n\r\n  className() {\r\n    return 'TagDiscussionModal';\r\n  }\r\n\r\n  title() {\r\n    return this.props.discussion\r\n      ? app.translator.trans('flarum-tags.forum.choose_tags.edit_title', {title: <em>{this.props.discussion.title()}</em>})\r\n      : app.translator.trans('flarum-tags.forum.choose_tags.title');\r\n  }\r\n\r\n  getInstruction(primaryCount, secondaryCount) {\r\n    if (primaryCount < this.minPrimary) {\r\n      const remaining = this.minPrimary - primaryCount;\r\n      return app.translator.transChoice('flarum-tags.forum.choose_tags.choose_primary_placeholder', remaining, {count: remaining});\r\n    } else if (secondaryCount < this.minSecondary) {\r\n      const remaining = this.minSecondary - secondaryCount;\r\n      return app.translator.transChoice('flarum-tags.forum.choose_tags.choose_secondary_placeholder', remaining, {count: remaining});\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  content() {\r\n    let tags = this.tags;\r\n    const filter = this.filter().toLowerCase();\r\n    const primaryCount = this.primaryCount();\r\n    const secondaryCount = this.secondaryCount();\r\n\r\n    // Filter out all child tags whose parents have not been selected. This\r\n    // makes it impossible to select a child if its parent hasn't been selected.\r\n    tags = tags.filter(tag => {\r\n      const parent = tag.parent();\r\n      return parent === false || this.selected.indexOf(parent) !== -1;\r\n    });\r\n\r\n    // If the number of selected primary/secondary tags is at the maximum, then\r\n    // we'll filter out all other tags of that type.\r\n    if (primaryCount >= this.maxPrimary) {\r\n      tags = tags.filter(tag => !tag.isPrimary() || this.selected.indexOf(tag) !== -1);\r\n    }\r\n\r\n    if (secondaryCount >= this.maxSecondary) {\r\n      tags = tags.filter(tag => tag.isPrimary() || this.selected.indexOf(tag) !== -1);\r\n    }\r\n\r\n    // If the user has entered text in the filter input, then filter by tags\r\n    // whose name matches what they've entered.\r\n    if (filter) {\r\n      tags = tags.filter(tag => tag.name().substr(0, filter.length).toLowerCase() === filter);\r\n    }\r\n\r\n    if (tags.indexOf(this.index) === -1) this.index = tags[0];\r\n\r\n    return [\r\n      <div className=\"Modal-body\">\r\n        <div className=\"TagDiscussionModal-form\">\r\n          <div className=\"TagDiscussionModal-form-input\">\r\n            <div className={'TagsInput FormControl ' + (this.focused ? 'focus' : '')}>\r\n              <span className=\"TagsInput-selected\">\r\n                {this.selected.map(tag =>\r\n                  <span className=\"TagsInput-tag\" onclick={() => {\r\n                    this.removeTag(tag);\r\n                    this.onready();\r\n                  }}>\r\n                    {tagLabel(tag)}\r\n                  </span>\r\n                )}\r\n              </span>\r\n              <input className=\"FormControl\"\r\n                placeholder={extractText(this.getInstruction(primaryCount, secondaryCount))}\r\n                value={this.filter()}\r\n                oninput={m.withAttr('value', this.filter)}\r\n                onkeydown={this.navigator.navigate.bind(this.navigator)}\r\n                onfocus={() => this.focused = true}\r\n                onblur={() => this.focused = false}/>\r\n            </div>\r\n          </div>\r\n          <div className=\"TagDiscussionModal-form-submit App-primaryControl\">\r\n            {Button.component({\r\n              type: 'submit',\r\n              className: 'Button Button--primary',\r\n              disabled: primaryCount < this.minPrimary || secondaryCount < this.minSecondary,\r\n              icon: 'fas fa-check',\r\n              children: app.translator.trans('flarum-tags.forum.choose_tags.submit_button')\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>,\r\n\r\n      <div className=\"Modal-footer\">\r\n        <ul className=\"TagDiscussionModal-list SelectTagList\">\r\n          {tags\r\n            .filter(tag => filter || !tag.parent() || this.selected.indexOf(tag.parent()) !== -1)\r\n            .map(tag => (\r\n              <li data-index={tag.id()}\r\n                className={classList({\r\n                  pinned: tag.position() !== null,\r\n                  child: !!tag.parent(),\r\n                  colored: !!tag.color(),\r\n                  selected: this.selected.indexOf(tag) !== -1,\r\n                  active: this.index === tag\r\n                })}\r\n                style={{color: tag.color()}}\r\n                onmouseover={() => this.index = tag}\r\n                onclick={this.toggleTag.bind(this, tag)}\r\n              >\r\n                {tagIcon(tag)}\r\n                <span className=\"SelectTagListItem-name\">\r\n                  {highlight(tag.name(), filter)}\r\n                </span>\r\n                {tag.description()\r\n                  ? (\r\n                    <span className=\"SelectTagListItem-description\">\r\n                      {tag.description()}\r\n                    </span>\r\n                  ) : ''}\r\n              </li>\r\n            ))}\r\n        </ul>\r\n      </div>\r\n    ];\r\n  }\r\n\r\n  toggleTag(tag) {\r\n    const index = this.selected.indexOf(tag);\r\n\r\n    if (index !== -1) {\r\n      this.removeTag(tag);\r\n    } else {\r\n      this.addTag(tag);\r\n    }\r\n\r\n    if (this.filter()) {\r\n      this.filter('');\r\n      this.index = this.tags[0];\r\n    }\r\n\r\n    this.onready();\r\n  }\r\n\r\n  select(e) {\r\n    // Ctrl + Enter submits the selection, just Enter completes the current entry\r\n    if (e.metaKey || e.ctrlKey || this.selected.indexOf(this.index) !== -1) {\r\n      if (this.selected.length) {\r\n        this.$('form').submit();\r\n      }\r\n    } else {\r\n      this.getItem(this.index)[0].dispatchEvent(new Event('click'));\r\n    }\r\n  }\r\n\r\n  selectableItems() {\r\n    return this.$('.TagDiscussionModal-list > li');\r\n  }\r\n\r\n  getCurrentNumericIndex() {\r\n    return this.selectableItems().index(\r\n      this.getItem(this.index)\r\n    );\r\n  }\r\n\r\n  getItem(index) {\r\n    return this.selectableItems().filter(`[data-index=\"${index.id()}\"]`);\r\n  }\r\n\r\n  setIndex(index, scrollToItem) {\r\n    const $items = this.selectableItems();\r\n    const $dropdown = $items.parent();\r\n\r\n    if (index < 0) {\r\n      index = $items.length - 1;\r\n    } else if (index >= $items.length) {\r\n      index = 0;\r\n    }\r\n\r\n    const $item = $items.eq(index);\r\n\r\n    this.index = app.store.getById('tags', $item.attr('data-index'));\r\n\r\n    m.redraw();\r\n\r\n    if (scrollToItem) {\r\n      const dropdownScroll = $dropdown.scrollTop();\r\n      const dropdownTop = $dropdown.offset().top;\r\n      const dropdownBottom = dropdownTop + $dropdown.outerHeight();\r\n      const itemTop = $item.offset().top;\r\n      const itemBottom = itemTop + $item.outerHeight();\r\n\r\n      let scrollTop;\r\n      if (itemTop < dropdownTop) {\r\n        scrollTop = dropdownScroll - dropdownTop + itemTop - parseInt($dropdown.css('padding-top'), 10);\r\n      } else if (itemBottom > dropdownBottom) {\r\n        scrollTop = dropdownScroll - dropdownBottom + itemBottom + parseInt($dropdown.css('padding-bottom'), 10);\r\n      }\r\n\r\n      if (typeof scrollTop !== 'undefined') {\r\n        $dropdown.stop(true).animate({scrollTop}, 100);\r\n      }\r\n    }\r\n  }\r\n\r\n  onsubmit(e) {\r\n    e.preventDefault();\r\n\r\n    const discussion = this.props.discussion;\r\n    const tags = this.selected;\r\n\r\n    if (discussion) {\r\n      discussion.save({relationships: {tags}})\r\n        .then(() => {\r\n          if (app.current instanceof DiscussionPage) {\r\n            app.current.stream.update();\r\n          }\r\n          m.redraw();\r\n        });\r\n    }\r\n\r\n    if (this.props.onsubmit) this.props.onsubmit(tags);\r\n\r\n    app.modal.close();\r\n\r\n    m.redraw.strategy('none');\r\n  }\r\n}\r\n","import { extend } from 'flarum/extend';\r\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\r\nimport Button from 'flarum/components/Button';\r\n\r\nimport TagDiscussionModal from './components/TagDiscussionModal';\r\n\r\nexport default function() {\r\n  // Add a control allowing the discussion to be moved to another category.\r\n  extend(DiscussionControls, 'moderationControls', function(items, discussion) {\r\n    if (discussion.canTag()) {\r\n      items.add('tags', Button.component({\r\n        children: app.translator.trans('flarum-tags.forum.discussion_controls.edit_tags_button'),\r\n        icon: 'fas fa-tag',\r\n        onclick: () => app.modal.show(new TagDiscussionModal({discussion}))\r\n      }));\r\n    }\r\n  });\r\n}\r\n","import { extend, override } from 'flarum/extend';\r\nimport IndexPage from 'flarum/components/IndexPage';\r\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\r\n\r\nimport TagDiscussionModal from './components/TagDiscussionModal';\r\nimport tagsLabel from '../common/helpers/tagsLabel';\r\n\r\nexport default function() {\r\n  extend(IndexPage.prototype, 'newDiscussionAction', function(promise) {\r\n    const tag = app.store.getBy('tags', 'slug', this.params().tags);\r\n\r\n    if (tag) {\r\n      const parent = tag.parent();\r\n      const tags = parent ? [parent, tag] : [tag];\r\n      promise.then(component => component.tags = tags);\r\n    }\r\n  });\r\n\r\n  // Add tag-selection abilities to the discussion composer.\r\n  DiscussionComposer.prototype.tags = [];\r\n  DiscussionComposer.prototype.chooseTags = function() {\r\n    app.modal.show(\r\n      new TagDiscussionModal({\r\n        selectedTags: this.tags.slice(0),\r\n        onsubmit: tags => {\r\n          this.tags = tags;\r\n          this.$('textarea').focus();\r\n        }\r\n      })\r\n    );\r\n  };\r\n\r\n  // Add a tag-selection menu to the discussion composer's header, after the\r\n  // title.\r\n  extend(DiscussionComposer.prototype, 'headerItems', function(items) {\r\n    items.add('tags', (\r\n      <a className=\"DiscussionComposer-changeTags\" onclick={this.chooseTags.bind(this)}>\r\n        {this.tags.length\r\n          ? tagsLabel(this.tags)\r\n          : <span className=\"TagLabel untagged\">{app.translator.trans('flarum-tags.forum.composer_discussion.choose_tags_link')}</span>}\r\n      </a>\r\n    ), 10);\r\n  });\r\n\r\n  override(DiscussionComposer.prototype, 'onsubmit', function(original) {\r\n    const chosenTags = this.tags;\r\n    const chosenPrimaryTags = chosenTags.filter(tag => tag.position() !== null && !tag.isChild());\r\n    const chosenSecondaryTags = chosenTags.filter(tag => tag.position() === null);\r\n    if (!chosenTags.length\r\n      || (chosenPrimaryTags.length < app.forum.attribute('minPrimaryTags'))\r\n      || (chosenSecondaryTags.length < app.forum.attribute('minSecondaryTags'))) {\r\n      app.modal.show(\r\n        new TagDiscussionModal({\r\n          selectedTags: chosenTags,\r\n          onsubmit: tags => {\r\n            this.tags = tags;\r\n            original();\r\n          }\r\n        })\r\n      );\r\n    } else {\r\n      original();\r\n    }\r\n  });\r\n\r\n  // Add the selected tags as data to submit to the server.\r\n  extend(DiscussionComposer.prototype, 'data', function(data) {\r\n    data.relationships = data.relationships || {};\r\n    data.relationships.tags = this.tags;\r\n  });\r\n}\r\n","import compat from '../common/compat';\r\n\r\nimport addTagFilter from './addTagFilter';\r\nimport addTagControl from './addTagControl';\r\nimport TagHero from './components/TagHero';\r\nimport TagDiscussionModal from './components/TagDiscussionModal';\r\nimport TagsPage from './components/TagsPage';\r\nimport DiscussionTaggedPost from './components/DiscussionTaggedPost';\r\nimport TagLinkButton from './components/TagLinkButton';\r\nimport addTagList from './addTagList';\r\nimport addTagLabels from './addTagLabels';\r\nimport addTagComposer from './addTagComposer';\r\n\r\nexport default Object.assign(compat, {\r\n  'tags/addTagFilter': addTagFilter,\r\n  'tags/addTagControl': addTagControl,\r\n  'tags/components/TagHero': TagHero,\r\n  'tags/components/TagDiscussionModal': TagDiscussionModal,\r\n  'tags/components/TagsPage': TagsPage,\r\n  'tags/components/DiscussionTaggedPost': DiscussionTaggedPost,\r\n  'tags/components/TagLinkButton': TagLinkButton,\r\n  'tags/addTagList': addTagList,\r\n  'tags/addTagLabels': addTagLabels,\r\n  'tags/addTagComposer': addTagComposer,\r\n});\r\n","import Model from 'flarum/Model';\r\nimport Discussion from 'flarum/models/Discussion';\r\nimport IndexPage from 'flarum/components/IndexPage';\r\n\r\nimport Tag from '../common/models/Tag';\r\nimport TagsPage from './components/TagsPage';\r\nimport DiscussionTaggedPost from './components/DiscussionTaggedPost';\r\n\r\nimport addTagList from './addTagList';\r\nimport addTagFilter from './addTagFilter';\r\nimport addTagLabels from './addTagLabels';\r\nimport addTagControl from './addTagControl';\r\nimport addTagComposer from './addTagComposer';\r\n\r\napp.initializers.add('flarum-tags', function(app) {\r\n  app.routes.tags = {path: '/tags', component: TagsPage.component()};\r\n  app.routes.tag = {path: '/t/:tags', component: IndexPage.component()};\r\n\r\n  app.route.tag = tag => app.route('tag', {tags: tag.slug()});\r\n\r\n  app.postComponents.discussionTagged = DiscussionTaggedPost;\r\n\r\n  app.store.models.tags = Tag;\r\n\r\n  Discussion.prototype.tags = Model.hasMany('tags');\r\n  Discussion.prototype.canTag = Model.attribute('canTag');\r\n\r\n  addTagList();\r\n  addTagFilter();\r\n  addTagLabels();\r\n  addTagControl();\r\n  addTagComposer();\r\n});\r\n\r\n\r\n// Expose compat API\r\nimport tagsCompat from './compat';\r\nimport { compat } from '@flarum/core/forum';\r\n\r\nObject.assign(compat, tagsCompat);","module.exports = flarum.core.compat['helpers/listItems'];","module.exports = flarum.core.compat['helpers/humanTime'];","module.exports = flarum.core.compat['components/EventPost'];","module.exports = flarum.core.compat['components/Separator'];","module.exports = flarum.core.compat['components/DiscussionList'];","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/DiscussionListItem'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['helpers/highlight'];","module.exports = flarum.core.compat['utils/extractText'];","module.exports = flarum.core.compat['utils/KeyboardNavigatable'];","/*\r\n * This file is part of Flarum.\r\n *\r\n * (c) Toby Zerner <toby.zerner@gmail.com>\r\n *\r\n * For the full copyright and license information, please view the LICENSE\r\n * file that was distributed with this source code.\r\n */\r\n\r\nexport * from './src/common';\r\nexport * from './src/forum';\r\n"],"sourceRoot":""}